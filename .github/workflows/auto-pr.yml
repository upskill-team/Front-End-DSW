name: Create Pull Request

on:
  push:
    branches:
      - 'feature/**'
      - 'bugfix/**'

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    steps:
      # Paso 1: Descargar el código.
      # fetch-depth: 0 es crucial para tener todo el historial y evitar problemas.
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Paso 2: Crear el Pull Request usando la CLI oficial de GitHub
      - name: Create Pull Request
        env:
          # El token de GitHub se pasa como una variable de entorno segura.
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Le decimos a la CLI que la rama base es 'develop'
          BASE_BRANCH="develop"

          # Obtenemos el nombre de nuestra rama feature (ej: 'feature/mi-trabajo')
          HEAD_BRANCH="${{ github.ref_name }}"

          # Creamos un título y cuerpo para el PR
          TITLE="PR: Merge ${HEAD_BRANCH} into ${BASE_BRANCH}"
          BODY="Pull Request automático creado para la rama \`${HEAD_BRANCH}\`. Por favor, revisar."

          # El comando mágico: gh pr create
          # --base: La rama a la que queremos fusionar.
          # --head: La rama que contiene nuestros cambios.
          # --title, --body: El título y la descripción.
          # --reviewer: Añadimos a los revisores.
          # --label: Añadimos las etiquetas.
          gh pr create \
            --base "${BASE_BRANCH}" \
            --head "${HEAD_BRANCH}" \
            --title "${TITLE}" \
            --body "${BODY}" \
            --reviewer "LucaTvl" \
            --label "automated-pr,needs-review"
